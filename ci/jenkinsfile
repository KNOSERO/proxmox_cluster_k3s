pipeline {
    agent {
        label 'home'
    }

    stages {
        stage('Konfiguracja kluczy SSH') {
            steps {
                withCredentials([sshUserPrivateKey(credentialsId: 'id_home_lab', keyFileVariable: 'SSH_KEY')]) {
                    sh '''
                        mkdir -p /root/.ssh
                        cp "$SSH_KEY" /root/.ssh/id_home_lab
                        chmod 600 /root/.ssh/id_home_lab
                       '''
                }
            }
        }

        stage('Destroy Custer') {
            when {
                expression { params.TASK == 'destroy' }
            }
            steps {
                echo "Deployuję DNS"
            }
        }

        stage('Apply Custer') {
            when {
                expression { params.TASK == 'apply' }
            }
            steps {
                echo "Deployuję Grafanę"
            }
        }
    }
}